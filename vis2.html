<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Child Malnutrition in Asia</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/vega@5.20.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.1.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.18.2"></script>
</head>
<body>

    <!-- Header Section -->
    <header>
        <h1>Child Malnutrition in Asia</h1>
        <p>
            Despite global efforts to reduce malnutrition, Asia continues to face significant challenges in stunting, wasting, 
            and overweight, impacting the health and future of millions of children.
        </p>
    </header>

    <!-- Stunting, Wasting, and Overweight Section -->
    <section>
        <h2>Stunting, Wasting & Overweight in Asia (1991-2019)</h2>
        <p class="description">
            Malnutrition remains prevalent in Asia, with stunting consistently being the most widespread form of malnutrition.
        </p>
        <div class="chart-container">
            <div id="linechart"></div>
        </div>
        <div class="key-insights">
            <h3>Key Insights:</h3>
            <ul>
                <li><strong>Stunting</strong> continues to be the most critical malnutrition issue across Asia.</li>
                <li><strong>Severe Wasting</strong> has remained relatively stable but still contributes to 20-30% of malnutrition-related deaths.</li>
                <li><strong>Overweight</strong> prevalence has been steadily rising since the early 2000s, increasing the risk of non-communicable diseases (NCDs) such as cardiovascular disease, diabetes, and cancer (Thapa et al., 2021).</li>
            </ul>
        </div>
    </section>

    <!-- Stunting in Malaysia Section -->
    <section>
        <h2>Stunting in Malaysia by State</h2>
        <p class="description">
            This map visualizes the stunting rates across various states in Malaysia.
        </p>
        <div class="chart-container">
            <div id="map"></div>
        </div>
        <div class="key-insights">
            <h3>Key Insights:</h3>
            <ul>
                <li><strong>Perak</strong> has the highest stunting rate at 22.7%, particularly in rural areas.</li>
            </ul>
        </div>
    </section>

    <!-- Vega Embed Scripts for Charts -->
    <script>
        // Line Chart for Trends in Malnutrition with Start and End Year Filters
        vegaEmbed('#linechart', {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "width": 800,
            "height": 400,
            "title": "Trends in National Estimates of Overweight, Stunting, and Severe Wasting (1986â€“2022)",
            "data": {
                "url": "https://raw.githubusercontent.com/bentez7/FIT3179/main/Cleaned_data.csv"
            },
            "transform": [{
                "fold": ["Overweight", "Stunting", "Severe"],
                "as": ["Types of Malnutrition", "National Point Estimate"]
            }],
            "mark": "line",
            "params": [
                {
                    "name": "startYear",
                    "value": 1986,
                    "bind": {
                        "input": "range",
                        "min": 1986,
                        "max": 2022,
                        "step": 1,
                        "name": "Start year: "
                    }
                },
                {
                    "name": "endYear",
                    "value": 2022,
                    "bind": {
                        "input": "range",
                        "min": 1986,
                        "max": 2022,
                        "step": 1,
                        "name": "End year: "
                    }
                }
            ],
            "transform": [
                {
                    "filter": "datum.Year >= startYear && datum.Year <= endYear"
                }
            ],
            "encoding": {
                "x": {"field": "Year", "type": "temporal", "axis": {"title": "Year"}},
                "y": {"field": "National Point Estimate", "type": "quantitative", "axis": {"title": "National Point Estimate"}},
                "color": {"field": "Types of Malnutrition", "type": "nominal", "legend": {"title": "Types of Malnutrition"}},
                "tooltip": [
                    {"field": "Year", "type": "temporal", "title": "Year"},
                    {"field": "National Point Estimate", "type": "quantitative", "title": "Estimate"},
                    {"field": "Types of Malnutrition", "type": "nominal", "title": "Malnutrition Type"}
                ]
            }
        }, {tooltip: true});

        // Map of Malaysia with Annotation for Perak
        vegaEmbed('#map', {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "title": "Stunting Percentage by State in Malaysia",
          "width": 800,
          "height": 400,
          "projection": {
            "type": "mercator",
            "scale": 2500,
            "translate": [500, 250],
            "center": [110, 3]
          },
          "layer": [
            {
              "data": {
                "url": "https://raw.githubusercontent.com/bentez7/FIT3179/main/malaysia-states.topojson",
                "format": {"type": "topojson", "feature": "states"}
              },
              "transform": [
                {
                  "lookup": "properties.Name",
                  "from": {
                    "data": {
                      "url": "https://raw.githubusercontent.com/bentez7/FIT3179/main/Stunting(Malaysia).csv",
                      "format": {"type": "csv"}
                    },
                    "key": "States",
                    "fields": ["Percentage"]
                  }
                }
              ],
              "mark": {"type": "geoshape"},
              "encoding": {
                "color": {
                  "field": "Percentage",
                  "type": "quantitative",
                  "scale": {"scheme": "reds"},
                  "legend": {"title": "Stunting (%)"}
                },
                "tooltip": [
                  {"field": "properties.Name", "type": "nominal", "title": "State"},
                  {"field": "Percentage", "type": "quantitative", "title": "Stunting (%)"}
                ]
              }
            },
            // Add annotation for Perak
            {
              "mark": {
                "type": "text",
                "align": "left",
                "dx": 10,
                "dy": -10,
                "fontSize": 12,
                "fontWeight": "bold",
                "color": "black"
              },
              "encoding": {
                "longitude": {"value": 101.0901},  // Longitude for Perak
                "latitude": {"value": 4.5933},     // Latitude for Perak
                "text": {"value": "Perak: 22.7%"}  // Annotation for Perak
              }
            }
          ]
        }, {tooltip: true});
    </script>

</body>
</html>
