<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Child Malnutrition in Asia</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/vega@5.20.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.1.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.18.2"></script>
</head>
<body>

    <!-- Header Section -->
    <header>
        <h1>Child Malnutrition in Asia</h1>
        <p>
            Despite global efforts to reduce malnutrition, Asia continues to face significant challenges in stunting, wasting, 
            and overweight, impacting the health and future of millions of children.
        </p>
    </header>

    <!-- Stunting, Wasting, and Overweight Section -->
    <section>
        <h2>Stunting, Wasting & Overweight in Asia (1991-2019)</h2>
        <p class="description">
            Malnutrition remains prevalent in Asia, with stunting consistently being the most widespread form of malnutrition.
        </p>
        <div class="chart-container">
            <div id="linechart"></div>
        </div>
        <div class="key-insights">
            <h3>Key Insights:</h3>
            <ul>
                <li><strong>Stunting</strong> continues to be the most critical malnutrition issue across Asia.</li>
                <li><strong>Severe Wasting</strong> has remained relatively stable but still contributes to 20-30% of malnutrition-related deaths.</li>
                <li><strong>Overweight</strong> prevalence has been steadily rising since the early 2000s, increasing the risk of non-communicable diseases (NCDs) such as cardiovascular disease, diabetes, and cancer (Thapa et al., 2021).</li>
            </ul>
        </div>
    </section>

    <!-- Stunting in Malaysia Section -->
    <section>
        <h2>Stunting in Malaysia by State</h2>
        <p class="description">
            This map visualizes the stunting rates across various states in Malaysia.
        </p>
        <div class="chart-container">
            <div id="map"></div>
        </div>
        <div class="key-insights">
            <h3>Key Insights:</h3>
            <ul>
                <li><strong>Perak</strong> has the highest stunting rate at 22.7%, particularly in rural areas.</li>
            </ul>
        </div>
    </section>

    <!-- Stunting Estimates by Income Group Section -->
    <section>
        <h2>Stunting Estimates by Income Group (Asian Countries)</h2>
        <p class="description">
            This bar chart illustrates the impact of income levels on stunting rates across Asian countries.
        </p>
        <div class="chart-container">
            <div id="barchart"></div>
        </div>
        <div class="key-insights">
            <h3>Key Insights:</h3>
            <ul>
                <li>Countries with higher stunting rates tend to fall within the <strong>“Lower Middle Income”</strong> group.</li>
                <li><strong>Bangladesh</strong> ranks first in stunting, followed by Nepal and India.</li>
            </ul>
        </div>
    </section>

    <!-- Stunting vs Education Disparity Section -->
    <section>
        <h2>Stunting Estimates vs Education Disparities in Asia</h2>
        <p class="description">
            This chart highlights the correlation between education inequality and stunting rates across Asia.
        </p>
        <div class="chart-container">
            <div id="scatterplot"></div>
        </div>
        <div class="key-insights">
            <h3>Key Insights:</h3>
            <ul>
                <li><strong>Higher education disparities</strong> are associated with increased stunting rates, as shown by the positive trend line.</li>
            </ul>
        </div>
    </section>

    <!-- Footer Section -->
    <footer>
        <p>For further insights, check our <a href="#">full report</a> and policy recommendations.</p>
        <p>&copy; 2024 Malnutrition Research. All rights reserved.</p>
    </footer>

    <!-- Vega Embed Scripts for Charts -->
    <script>
        // Line Chart for Trends in Malnutrition with hover interaction to display the year
        vegaEmbed('#linechart', {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "width": 800,
            "height": 400,
            "title": "Trends in National Estimates of Overweight, Stunting, and Severe Wasting (1986–2022)",
            "data": {
                "url": "https://raw.githubusercontent.com/bentez7/FIT3179/main/Cleaned_data.csv"
            },
            "transform": [{
                "fold": ["Overweight", "Stunting", "Severe"],
                "as": ["Types of Malnutrition", "National Point Estimate"]
            }],
            "layer": [
                {
                    "mark": "line",
                    "encoding": {
                        "x": {
                            "field": "Year",
                            "type": "temporal",
                            "axis": {"title": "Year"}
                        },
                        "y": {
                            "field": "National Point Estimate",
                            "type": "quantitative",
                            "axis": {"title": "National Point Estimate"}
                        },
                        "color": {
                            "field": "Types of Malnutrition",
                            "type": "nominal",
                            "legend": {"title": "Types of Malnutrition"}
                        }
                    }
                },
                {
                    "params": [{
                        "name": "hoverPoint",
                        "select": {
                            "type": "point",
                            "fields": ["Year"],  // Track Year field
                            "on": "mouseover",   // Trigger hover on mouseover
                            "nearest": true
                        }
                    }],
                    "mark": {"type": "point"},
                    "encoding": {
                        "x": {"field": "Year", "type": "temporal"},
                        "y": {"field": "National Point Estimate", "type": "quantitative"},
                        "opacity": {"value": 0}  // Hide the point, used for interaction
                    }
                },
                {
                    "transform": [
                        {"filter": {"param": "hoverPoint"}}
                    ],
                    "mark": "rule",  // Vertical line at the hovered point
                    "encoding": {
                        "x": {"field": "Year", "type": "temporal"},
                        "color": {"value": "black"},  // Set the color of the rule
                        "size": {"value": 1}  // Thickness of the rule
                    }
                },
                {
                    "transform": [
                        {"filter": {"param": "hoverPoint"}}
                    ],
                    "mark": "text",
                    "encoding": {
                        "x": {"field": "Year", "type": "temporal"},
                        "y": {"value": 10},  // Position the text at the top of the chart
                        "text": {"field": "Year", "type": "temporal", "format": "%Y"},  // Display only the year
                        "color": {"value": "black"}
                    }
                }
            ]
        }, {tooltip: true});

        // Bar Chart with dropdown for filtering Income Groups
        vegaEmbed('#barchart', {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "width": 750,
            "height": 400,
            "title": "Stunting Estimates by Income Group (Asian Countries)",
            "data": {
                "url": "https://raw.githubusercontent.com/bentez7/FIT3179/main/Income%20and%20stunning%20dataset.csv",
                "format": {"type": "csv"}
            },
            "transform": [
                {
                    "filter": {"param": "incomeGroupSelection"}  // Apply filter based on the dropdown selection
                }
            ],
            "selection": {
                "incomeGroupSelection": {
                    "type": "single",  // Single selection for dropdown
                    "fields": ["Income Groups"],  // Field to filter
                    "bind": {
                        "input": "select",  // Use a dropdown selection box
                        "options": [
                            null,  // Allow no filtering option (shows all)
                            "High Income",
                            "Upper Middle Income",
                            "Lower Middle Income"
                        ],
                        "name": "Select Income Group: "  // Label for the dropdown box
                    }
                }
            },
            "mark": "bar",
            "encoding": {
                "y": {"field": "Countries", "type": "nominal", "title": "Country", "sort": "-x"},
                "x": {"field": "Estimate", "type": "quantitative", "title": "Stunting (%)"},
                "color": {
                    "field": "Income Groups",
                    "type": "nominal",
                    "title": "Income Group",
                    "scale": {
                        "domain": ["High Income", "Upper Middle Income", "Lower Middle Income"],
                        "range": ["#377eb8", "#e41a1c", "#ff7f00"]
                    }
                },
                "tooltip": [
                    {"field": "Countries", "type": "nominal"},
                    {"field": "Estimate", "type": "quantitative"},
                    {"field": "Income Groups", "type": "nominal"}
                ]
            }
        }, {tooltip: true});

        // Scatterplot for Education vs Stunting with Annotations
        vegaEmbed('#scatterplot', {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "width": 900,
            "height": 400,
            "title": "Stunting Estimates vs Education Disparities in Asia",
            "data": {
                "url": "https://raw.githubusercontent.com/bentez7/FIT3179/main/Education%20and%20stunning.csv",
                "format": {"type": "csv"}
            },
            "layer": [{
                "mark": "point",
                "encoding": {
                    "x": {"field": "Education", "type": "quantitative", "title": "Education Disparity"},
                    "y": {"field": "Estimate", "type": "quantitative", "title": "Stunting Estimate (%)"},
                    "tooltip": [{"field": "Education", "type": "quantitative"}, {"field": "Estimate", "type": "quantitative"}],
                    "color": {"condition": {"test": "datum.Estimate > datum.Education", "value": "red"}, "value": "blue"}
                }
            }, {
                "mark": {"type": "line", "color": "black", "strokeDash": [4, 4]},
                "transform": [{"regression": "Estimate", "on": "Education", "method": "linear"}],
                "encoding": {"x": {"field": "Education", "type": "quantitative"}, "y": {"field": "Estimate", "type": "quantitative"}}
            },
              {
                  "mark": {
                    "type": "text",
                    "align": "left",
                    "dx": 5,
                    "dy": -5,
                    "fontSize": 12,
                    "fontWeight": "bold",
                    "color": "black"
                  },
                  "encoding": {
                    "x": {"value": 12.3},  // X position (Education)
                    "y": {"value": 63.8},  // Y position (Estimate)
                    "text": {"value": "Education: 12.3, Estimate: 63.8"}  // Annotation text
                  }
              }]
        }, {tooltip: true});

        // Map of Malaysia with Annotations for Perak
        vegaEmbed('#map', {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "title": "Stunting Percentage by State in Malaysia",
          "width": 860,
          "height": 400,
          "projection": {
            "type": "mercator",
            "scale": 2500,  // Zoom in on Malaysia
            "translate": [500, 250],
            "center": [110, 3]  
          },
          "layer": [
            {
              "mark": {"type": "geoshape", "fill": "#e0dac2", "stroke": "white"}
            },
            {
              "data": {
                "url": "https://raw.githubusercontent.com/bentez7/FIT3179/main/malaysia-states.topojson", // TopoJSON for states
                "format": {"type": "topojson", "feature": "states"}
              },
              "transform": [
                {
                  "lookup": "properties.Name",
                  "from": {
                    "data": {
                      "url": "https://raw.githubusercontent.com/bentez7/FIT3179/main/Stunting(Malaysia).csv",
                      "format": {"type": "csv"}
                    },
                    "key": "States",
                    "fields": ["Percentage"]
                  }
                }
              ],
              "mark": {"type": "geoshape"},
              "encoding": {
                "color": {
                  "field": "Percentage",
                  "type": "quantitative",
                  "scale": {"scheme": "reds"},  // Red shades for stunting rates
                  "legend": {"title": "Stunting (%)"}
                },
                "tooltip": [
                  {"field": "properties.Name", "type": "nominal", "title": "State"},
                  {"field": "Percentage", "type": "quantitative", "title": "Stunting (%)"}
                ]
              }
            },
            // Annotation for Perak (this layer comes LAST to appear on top)
            {
              "mark": {
                "type": "text",
                "align": "left",
                "dx": 15,  // Adjusted for better placement
                "dy": -5,
                "fontSize": 12,
                "fontWeight": "bold",
                "color": "black"
              },
              "encoding": {
                "longitude": {"value": 101.0901},  // Longitude for Perak
                "latitude": {"value": 4.5921},     // Latitude for Perak
                "text": {"value": "Perak: 22.7%"}  // Annotation text for Perak
              }
            }
          ]
        }, {tooltip: true});
    </script>
</body>
</html>
